syntax = "proto3";

package shreddr;

option go_package = "github.com/alecsavvy/shreddr/server/api";

// TicketPayload contains the core ticket data before signing
message TicketPayload {
  string event_id = 1;
  string event_name = 2;
  string event_date = 3; // ISO 8601 timestamp
  string ticket_id = 4;
  string purchased_at = 5; // ISO 8601 timestamp
  string owner_wallet = 6; // Solana wallet address
}

// Ticket represents a signed, redeemable ticket
message Ticket {
  TicketPayload payload = 1;
  string signature = 2; // Base64 encoded signature
  string public_key = 3; // Base58 encoded public key
  bool redeemed = 4;
  string redeemed_at = 5; // ISO 8601 timestamp, optional
}

message ListTicketsRequest {
  string user_id = 1; // Phantom auth user ID
  string event_id = 2; // Optional: filter by event
  bool include_redeemed = 3; // Include redeemed tickets
}

message ListTicketsResponse {
  repeated Ticket tickets = 1;
}

message GetTicketRequest {
  string ticket_id = 1;
}

message GetTicketResponse {
  Ticket ticket = 1;
}

message CreateTicketRequest {
  string event_id = 1;
  string owner_wallet = 2; // Solana wallet address
  string purchase_id = 3; // Reference to purchase record
}

message CreateTicketResponse {
  Ticket ticket = 1;
}

message RedeemTicketRequest {
  string ticket_id = 1;
  string redeemed_by = 2; // User ID or wallet address of redeemer
}

message RedeemTicketResponse {
  Ticket ticket = 1;
}

message VerifyTicketRequest {
  string ticket_id = 1;
  string signature = 2; // Optional: verify signature
}

message VerifyTicketResponse {
  bool valid = 1;
  Ticket ticket = 2; // Ticket if valid
  string error = 3; // Error message if invalid
}
